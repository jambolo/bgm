(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
// DRAG_THRESHOLD_PIXELS = 16
var BGMGameScene, BGMHudScene, init;

BGMGameScene = class BGMGameScene extends Phaser.Scene {
  constructor() {
    var i, j, k, l, ref, ref1;
    super();
    Phaser.Scene.call(this, {
      key: 'game',
      active: true
    });
    this.width = 60;
    this.height = 30;
    this.grid = new Array(this.width);
    for (i = k = 0, ref = this.width; (0 <= ref ? k < ref : k > ref); i = 0 <= ref ? ++k : --k) {
      this.grid[i] = new Array(this.height);
      for (j = l = 0, ref1 = this.height; (0 <= ref1 ? l < ref1 : l > ref1); j = 0 <= ref1 ? ++l : --l) {
        this.grid[i][j] = {
          bomb: false,
          sprite: null
        };
      }
    }
    this.touch = {
      ENGAGE_DRAG_DISTANCE: 10,
      DOUBLE_CLICK_MS: 400,
      tracked: [],
      dragX: 0,
      dragY: 0,
      dragging: false,
      doubleClickTime: null,
      pinchAnchor: null,
      pinchAnchorWorld: null
    };
  }

  preload() {
    this.load.image('blank', 'images/blank.gif');
    return this.load.image('flag', 'images/bombflagged.gif');
  }

  create() {
    var i, j, k, l, ref, ref1;
    for (i = k = 0, ref = this.width; (0 <= ref ? k < ref : k > ref); i = 0 <= ref ? ++k : --k) {
      for (j = l = 0, ref1 = this.height; (0 <= ref1 ? l < ref1 : l > ref1); j = 0 <= ref1 ? ++l : --l) {
        this.grid[i][j].sprite = this.add.image(i * 16, j * 16, 'blank');
        this.grid[i][j].sprite.setOrigin(0, 0);
        this.grid[0][0].sprite.setTexture('flag');
      }
    }
    this.input.addPointer(1);
    this.input.on('pointerdown', (pointer) => {
      var clickDelta, now;
      if (this.touch.tracked.length === 0) {
        this.touch.dragging = false;
      }
      console.log(`new pointer ${pointer.id}`);
      this.touch.tracked.push({
        id: pointer.id,
        pos: pointer.position.clone()
      });
      if (this.touch.tracked.length === 1) {
        this.setDragPoint();
      }
      if (this.touch.tracked.length === 2) {
        // We just added a second touch spot. Calculate the anchor for pinching now
        this.calcPinchAnchor();
      }
      if (this.touch.tracked.length > 1) {
        this.touch.dragging = true;
        return this.touch.doubleClickTime = null;
      } else if (!this.touch.dragging) {
        now = new Date().getTime();
        if (this.touch.doubleClickTime !== null) {
          // second click
          clickDelta = now - this.touch.doubleClickTime;
          if (clickDelta < this.touch.DOUBLE_CLICK_MS) {
            this.touch.doubleClickTime = null;
            console.log(`DOUBLE TAP ${this.touch.tracked[0].pos.x} ${this.touch.tracked[0].pos.y}`);
            return;
          }
        }
        return this.touch.doubleClickTime = now;
      }
    });
    this.input.on('pointermove', (pointer) => {
      var currDistance, deltaDistance, dragDistance, dx, dy, halfH, halfW, index, m, newZoom, offsetX, offsetY, prevDistance, prevX, prevY, ref2;
      prevDistance = 0;
      if (this.touch.tracked.length >= 2) {
        prevDistance = this.calcDistance(this.touch.tracked[0].pos.x, this.touch.tracked[0].pos.y, this.touch.tracked[1].pos.x, this.touch.tracked[1].pos.y);
      }
      if (this.touch.tracked.length === 1) {
        prevX = this.touch.tracked[0].pos.x;
        prevY = this.touch.tracked[0].pos.y;
      }
      index = -1;
      for (i = m = 0, ref2 = this.touch.tracked.length; (0 <= ref2 ? m < ref2 : m > ref2); i = 0 <= ref2 ? ++m : --m) {
        if (this.touch.tracked[i].id === pointer.id) {
          index = i;
          break;
        }
      }
      if (index !== -1) {
        // console.log "updating touch #{id}, tracking #{@touch.tracked.length} touches"
        this.touch.tracked[index].pos = pointer.position.clone();
      }
      if (this.touch.tracked.length === 1) {
        // single touch, consider dragging
        dragDistance = this.calcDistance(this.touch.dragX, this.touch.dragY, this.touch.tracked[0].pos.x, this.touch.tracked[0].pos.y);
        if (this.touch.dragging || (dragDistance > this.touch.ENGAGE_DRAG_DISTANCE)) {
          this.touch.dragging = true;
          if (dragDistance > 0.5) {
            dx = this.touch.tracked[0].pos.x - this.touch.dragX;
            dy = this.touch.tracked[0].pos.y - this.touch.dragY;
            // console.log "single drag: #{dx}, #{dy}"
            this.cameras.main.scrollX -= dx / this.cameras.main.zoom;
            this.cameras.main.scrollY -= dy / this.cameras.main.zoom;
            console.log(`scroll ${this.cameras.main.scrollX} ${this.cameras.main.zoom} ${this.cameras.main.width}`);
          }
          this.setDragPoint();
        }
      } else if (this.touch.tracked.length >= 2) {
        // at least two fingers present, check for pinch/zoom
        currDistance = this.calcDistance(this.touch.tracked[0].pos.x, this.touch.tracked[0].pos.y, this.touch.tracked[1].pos.x, this.touch.tracked[1].pos.y);
        deltaDistance = currDistance - prevDistance;
        if (deltaDistance !== 0) {
          newZoom = this.cameras.main.zoom * (1 + (deltaDistance * 4 / this.cameras.main.width));
          if (newZoom < 0.1) {
            newZoom = 0.1;
          }
          if (newZoom > 5) {
            newZoom = 5;
          }
          this.cameras.main.zoom = newZoom;
          halfW = this.cameras.main.width / 2;
          halfH = this.cameras.main.height / 2;
          offsetX = (this.touch.pinchAnchor.x - halfW) / newZoom;
          offsetY = (this.touch.pinchAnchor.y - halfH) / newZoom;
          this.cameras.main.scrollX = this.touch.pinchAnchorWorld.x - halfW - offsetX;
          this.cameras.main.scrollY = this.touch.pinchAnchorWorld.y - halfH - offsetY;
        }
      }
    });
    return this.input.on('pointerup', (pointer) => {
      var hud, index, m, ref2, worldPos;
      if (this.touch.tracked.length === 1) {
        if (!this.touch.dragging) {
          worldPos = this.cameras.main.getWorldPoint(this.touch.tracked[0].pos.x, this.touch.tracked[0].pos.y);
          console.log(`TAP ${worldPos.x} ${worldPos.y} ${this.cameras.main.scrollX} ${this.cameras.main.scrollY} ${this.cameras.main.zoom}`);
        }
      }
      index = -1;
      for (i = m = 0, ref2 = this.touch.tracked.length; (0 <= ref2 ? m < ref2 : m > ref2); i = 0 <= ref2 ? ++m : --m) {
        if (this.touch.tracked[i].id === pointer.id) {
          index = i;
          break;
        }
      }
      if (index !== -1) {
        this.touch.tracked.splice(index, 1);
        if (this.touch.tracked.length === 1) {
          this.setDragPoint();
        }
        if (index < 2) {
          // We just forgot one of our pinch touches. Pick a new anchor spot.
          this.calcPinchAnchor();
        }
      }
      hud = this.scene.get('hud');
      hud.glass.alpha = 0;
    });
  }

  calcDistance(x1, y1, x2, y2) {
    var dx, dy;
    dx = x2 - x1;
    dy = y2 - y1;
    return Math.sqrt(dx * dx + dy * dy);
  }

  setDragPoint() {
    this.touch.dragX = this.touch.tracked[0].pos.x;
    return this.touch.dragY = this.touch.tracked[0].pos.y;
  }

  calcPinchAnchor() {
    var hud, pinchX, pinchY;
    if (this.touch.tracked.length >= 2) {
      pinchX = Math.floor((this.touch.tracked[0].pos.x + this.touch.tracked[1].pos.x) / 2);
      pinchY = Math.floor((this.touch.tracked[0].pos.y + this.touch.tracked[1].pos.y) / 2);
      this.touch.pinchAnchor = {
        x: pinchX,
        y: pinchY
      };
      this.touch.pinchAnchorWorld = this.cameras.main.getWorldPoint(pinchX, pinchY); // { x: pinchX, y: pinchY }
      console.log(`pinchAnchor ${this.touch.pinchAnchor.x} ${this.touch.pinchAnchor.y}`);
      hud = this.scene.get('hud');
      hud.glass.x = this.touch.pinchAnchor.x;
      hud.glass.y = this.touch.pinchAnchor.y;
      return hud.glass.alpha = 1;
    }
  }

  tap(worldX, worldY) {
    var hud, x, y;
    hud = this.scene.get('hud');
    hud.debugText.text = `Tapped: ${worldX.toFixed(1)} ${worldY.toFixed(1)}`;
    if ((worldX >= 0) && (worldX < (this.width * 16)) && (worldY >= 0) && (worldY < (this.height * 16))) {
      x = Math.floor(worldX / 16);
      y = Math.floor(worldY / 16);
      this.grid[x][y].bomb = !this.grid[x][y].bomb;
      if (this.grid[x][y].bomb) {
        return this.grid[x][y].sprite.setTexture('flag');
      } else {
        return this.grid[x][y].sprite.setTexture('blank');
      }
    }
  }

  update() {}

};

BGMHudScene = class BGMHudScene extends Phaser.Scene {
  constructor() {
    super();
    Phaser.Scene.call(this, {
      key: 'hud',
      active: true
    });
  }

  preload() {
    return this.load.image('glass', 'images/glass.gif');
  }

  create() {
    this.debugText = this.add.text(0, 0, 'Tap somewhere!');
    this.glass = this.add.image(50, 50, 'glass');
    this.glass.setOrigin(0.6, 0.3); // roughly the middle of the magnifying glass
    return this.glass.alpha = 0;
  }

};

init = function() {
  var config, game;
  console.log("Bad Guy Minesweeper: init()");
  config = {
    type: Phaser.AUTO,
    width: document.documentElement.clientWidth,
    height: document.documentElement.clientHeight,
    backgroundColor: '#2d2d2d',
    parent: 'screen',
    input: {
      activePointers: 2
    },
    scene: [BGMGameScene, BGMHudScene]
  };
  return game = new Phaser.Game(config);
};

window.addEventListener('load', function(e) {
  return init();
}, false);


},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvbWFpbi5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBNEI7QUFBQSxJQUFBLFlBQUEsRUFBQSxXQUFBLEVBQUE7O0FBRXRCLGVBQU4sTUFBQSxhQUFBLFFBQTJCLE1BQU0sQ0FBQyxNQUFsQztFQUNFLFdBQWEsQ0FBQSxDQUFBO0FBQ2YsUUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBO1NBQUksQ0FBQTtJQUNBLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBYixDQUFrQixJQUFsQixFQUF3QjtNQUFFLEdBQUEsRUFBSyxNQUFQO01BQWUsTUFBQSxFQUFRO0lBQXZCLENBQXhCO0lBRUEsSUFBQyxDQUFBLEtBQUQsR0FBUztJQUNULElBQUMsQ0FBQSxNQUFELEdBQVU7SUFFVixJQUFDLENBQUEsSUFBRCxHQUFRLElBQUksS0FBSixDQUFVLElBQUMsQ0FBQSxLQUFYO0lBQ1IsS0FBUyxxRkFBVDtNQUNFLElBQUMsQ0FBQSxJQUFJLENBQUMsQ0FBRCxDQUFMLEdBQVcsSUFBSSxLQUFKLENBQVUsSUFBQyxDQUFBLE1BQVg7TUFDWCxLQUFTLDJGQUFUO1FBQ0UsSUFBQyxDQUFBLElBQUksQ0FBQyxDQUFELENBQUcsQ0FBQyxDQUFELENBQVIsR0FDRTtVQUFBLElBQUEsRUFBTSxLQUFOO1VBQ0EsTUFBQSxFQUFRO1FBRFI7TUFGSjtJQUZGO0lBT0EsSUFBQyxDQUFBLEtBQUQsR0FDRTtNQUFBLG9CQUFBLEVBQXNCLEVBQXRCO01BQ0EsZUFBQSxFQUFpQixHQURqQjtNQUVBLE9BQUEsRUFBUyxFQUZUO01BR0EsS0FBQSxFQUFPLENBSFA7TUFJQSxLQUFBLEVBQU8sQ0FKUDtNQUtBLFFBQUEsRUFBVSxLQUxWO01BTUEsZUFBQSxFQUFpQixJQU5qQjtNQU9BLFdBQUEsRUFBYSxJQVBiO01BUUEsZ0JBQUEsRUFBa0I7SUFS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LENBQUEsSUFBSSxDQUFDLEtBQU4sQ0FBWSxPQUFaLEVBQXFCLGtCQUFyQjtFQURPOztFQUdULE1BQVEsQ0FBQSxDQUFBO0lBQ04sSUFBQyxDQUFBLFNBQUQsR0FBYSxJQUFDLENBQUEsR0FBRyxDQUFDLElBQUwsQ0FBVSxDQUFWLEVBQWEsQ0FBYixFQUFnQixnQkFBaEI7SUFDYixJQUFDLENBQUEsS0FBRCxHQUFTLElBQUMsQ0FBQSxHQUFHLENBQUMsS0FBTCxDQUFXLEVBQVgsRUFBZSxFQUFmLEVBQW1CLE9BQW5CO0lBQ1QsSUFBQyxDQUFBLEtBQUssQ0FBQyxTQUFQLENBQWlCLEdBQWpCLEVBQXNCLEdBQXRCLEVBRko7V0FHSSxJQUFDLENBQUEsS0FBSyxDQUFDLEtBQVAsR0FBZTtFQUpUOztBQVJWOztBQWNBLElBQUEsR0FBTyxRQUFBLENBQUEsQ0FBQTtBQUNQLE1BQUEsTUFBQSxFQUFBO0VBQUUsT0FBTyxDQUFDLEdBQVIsQ0FBWSw2QkFBWjtFQUVBLE1BQUEsR0FDRTtJQUFBLElBQUEsRUFBTSxNQUFNLENBQUMsSUFBYjtJQUNBLEtBQUEsRUFBTyxRQUFRLENBQUMsZUFBZSxDQUFDLFdBRGhDO0lBRUEsTUFBQSxFQUFRLFFBQVEsQ0FBQyxlQUFlLENBQUMsWUFGakM7SUFHQSxlQUFBLEVBQWlCLFNBSGpCO0lBSUEsTUFBQSxFQUFRLFFBSlI7SUFLQSxLQUFBLEVBQ0U7TUFBQSxjQUFBLEVBQWdCO0lBQWhCLENBTkY7SUFPQSxLQUFBLEVBQU8sQ0FDTCxZQURLLEVBRUwsV0FGSztFQVBQO1NBWUYsSUFBQSxHQUFPLElBQUksTUFBTSxDQUFDLElBQVgsQ0FBZ0IsTUFBaEI7QUFoQkY7O0FBbUJQLE1BQU0sQ0FBQyxnQkFBUCxDQUF3QixNQUF4QixFQUFnQyxRQUFBLENBQUMsQ0FBRCxDQUFBO1NBQzVCLElBQUEsQ0FBQTtBQUQ0QixDQUFoQyxFQUVFLEtBRkYiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIjIERSQUdfVEhSRVNIT0xEX1BJWEVMUyA9IDE2XHJcblxyXG5jbGFzcyBCR01HYW1lU2NlbmUgZXh0ZW5kcyBQaGFzZXIuU2NlbmVcclxuICBjb25zdHJ1Y3RvcjogLT5cclxuICAgIHN1cGVyKClcclxuICAgIFBoYXNlci5TY2VuZS5jYWxsKHRoaXMsIHsga2V5OiAnZ2FtZScsIGFjdGl2ZTogdHJ1ZSB9KTtcclxuXHJcbiAgICBAd2lkdGggPSA2MFxyXG4gICAgQGhlaWdodCA9IDMwXHJcblxyXG4gICAgQGdyaWQgPSBuZXcgQXJyYXkoQHdpZHRoKVxyXG4gICAgZm9yIGkgaW4gWzAuLi5Ad2lkdGhdXHJcbiAgICAgIEBncmlkW2ldID0gbmV3IEFycmF5KEBoZWlnaHQpXHJcbiAgICAgIGZvciBqIGluIFswLi4uQGhlaWdodF1cclxuICAgICAgICBAZ3JpZFtpXVtqXSA9XHJcbiAgICAgICAgICBib21iOiBmYWxzZVxyXG4gICAgICAgICAgc3ByaXRlOiBudWxsXHJcblxyXG4gICAgQHRvdWNoID1cclxuICAgICAgRU5HQUdFX0RSQUdfRElTVEFOQ0U6IDEwXHJcbiAgICAgIERPVUJMRV9DTElDS19NUzogNDAwXHJcbiAgICAgIHRyYWNrZWQ6IFtdXHJcbiAgICAgIGRyYWdYOiAwXHJcbiAgICAgIGRyYWdZOiAwXHJcbiAgICAgIGRyYWdnaW5nOiBmYWxzZVxyXG4gICAgICBkb3VibGVDbGlja1RpbWU6IG51bGxcclxuICAgICAgcGluY2hBbmNob3I6IG51bGxcclxuICAgICAgcGluY2hBbmNob3JXb3JsZDogbnVsbFxyXG5cclxuXHJcbiAgcHJlbG9hZDogLT5cclxuICAgIEBsb2FkLmltYWdlKCdibGFuaycsICdpbWFnZXMvYmxhbmsuZ2lmJylcclxuICAgIEBsb2FkLmltYWdlKCdmbGFnJywgJ2ltYWdlcy9ib21iZmxhZ2dlZC5naWYnKVxyXG5cclxuICBjcmVhdGU6IC0+XHJcbiAgICBmb3IgaSBpbiBbMC4uLkB3aWR0aF1cclxuICAgICAgZm9yIGogaW4gWzAuLi5AaGVpZ2h0XVxyXG4gICAgICAgIEBncmlkW2ldW2pdLnNwcml0ZSA9IEBhZGQuaW1hZ2UoaSAqIDE2LCBqICogMTYsICdibGFuaycpXHJcbiAgICAgICAgQGdyaWRbaV1bal0uc3ByaXRlLnNldE9yaWdpbigwLCAwKVxyXG5cclxuICAgICAgICBAZ3JpZFswXVswXS5zcHJpdGUuc2V0VGV4dHVyZSgnZmxhZycpXHJcblxyXG4gICAgQGlucHV0LmFkZFBvaW50ZXIoMSlcclxuXHJcbiAgICBAaW5wdXQub24gJ3BvaW50ZXJkb3duJywgKHBvaW50ZXIpID0+XHJcbiAgICAgIGlmIEB0b3VjaC50cmFja2VkLmxlbmd0aCA9PSAwXHJcbiAgICAgICAgQHRvdWNoLmRyYWdnaW5nID0gZmFsc2VcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nIFwibmV3IHBvaW50ZXIgI3twb2ludGVyLmlkfVwiXHJcbiAgICAgIEB0b3VjaC50cmFja2VkLnB1c2gge1xyXG4gICAgICAgIGlkOiBwb2ludGVyLmlkXHJcbiAgICAgICAgcG9zOiBwb2ludGVyLnBvc2l0aW9uLmNsb25lKClcclxuICAgICAgfVxyXG4gICAgICBpZiBAdG91Y2gudHJhY2tlZC5sZW5ndGggPT0gMVxyXG4gICAgICAgIEBzZXREcmFnUG9pbnQoKVxyXG4gICAgICBpZiBAdG91Y2gudHJhY2tlZC5sZW5ndGggPT0gMlxyXG4gICAgICAgICMgV2UganVzdCBhZGRlZCBhIHNlY29uZCB0b3VjaCBzcG90LiBDYWxjdWxhdGUgdGhlIGFuY2hvciBmb3IgcGluY2hpbmcgbm93XHJcbiAgICAgICAgQGNhbGNQaW5jaEFuY2hvcigpXHJcblxyXG4gICAgICBpZiBAdG91Y2gudHJhY2tlZC5sZW5ndGggPiAxXHJcbiAgICAgICAgQHRvdWNoLmRyYWdnaW5nID0gdHJ1ZVxyXG4gICAgICAgIEB0b3VjaC5kb3VibGVDbGlja1RpbWUgPSBudWxsXHJcbiAgICAgIGVsc2UgaWYgbm90IEB0b3VjaC5kcmFnZ2luZ1xyXG4gICAgICAgIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpXHJcbiAgICAgICAgaWYgQHRvdWNoLmRvdWJsZUNsaWNrVGltZSAhPSBudWxsXHJcbiAgICAgICAgICAjIHNlY29uZCBjbGlja1xyXG4gICAgICAgICAgY2xpY2tEZWx0YSA9IG5vdyAtIEB0b3VjaC5kb3VibGVDbGlja1RpbWVcclxuICAgICAgICAgIGlmIGNsaWNrRGVsdGEgPCBAdG91Y2guRE9VQkxFX0NMSUNLX01TXHJcbiAgICAgICAgICAgIEB0b3VjaC5kb3VibGVDbGlja1RpbWUgPSBudWxsXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nIFwiRE9VQkxFIFRBUCAje0B0b3VjaC50cmFja2VkWzBdLnBvcy54fSAje0B0b3VjaC50cmFja2VkWzBdLnBvcy55fVwiXHJcbiAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgIEB0b3VjaC5kb3VibGVDbGlja1RpbWUgPSBub3dcclxuXHJcbiAgICBAaW5wdXQub24gJ3BvaW50ZXJtb3ZlJywgKHBvaW50ZXIpID0+XHJcbiAgICAgIHByZXZEaXN0YW5jZSA9IDBcclxuICAgICAgaWYgQHRvdWNoLnRyYWNrZWQubGVuZ3RoID49IDJcclxuICAgICAgICBwcmV2RGlzdGFuY2UgPSBAY2FsY0Rpc3RhbmNlKEB0b3VjaC50cmFja2VkWzBdLnBvcy54LCBAdG91Y2gudHJhY2tlZFswXS5wb3MueSwgQHRvdWNoLnRyYWNrZWRbMV0ucG9zLngsIEB0b3VjaC50cmFja2VkWzFdLnBvcy55KVxyXG4gICAgICBpZiBAdG91Y2gudHJhY2tlZC5sZW5ndGggPT0gMVxyXG4gICAgICAgIHByZXZYID0gQHRvdWNoLnRyYWNrZWRbMF0ucG9zLnhcclxuICAgICAgICBwcmV2WSA9IEB0b3VjaC50cmFja2VkWzBdLnBvcy55XHJcblxyXG4gICAgICBpbmRleCA9IC0xXHJcbiAgICAgIGZvciBpIGluIFswLi4uQHRvdWNoLnRyYWNrZWQubGVuZ3RoXVxyXG4gICAgICAgIGlmIEB0b3VjaC50cmFja2VkW2ldLmlkID09IHBvaW50ZXIuaWRcclxuICAgICAgICAgIGluZGV4ID0gaVxyXG4gICAgICAgICAgYnJlYWtcclxuICAgICAgaWYgaW5kZXggIT0gLTFcclxuICAgICAgICAjIGNvbnNvbGUubG9nIFwidXBkYXRpbmcgdG91Y2ggI3tpZH0sIHRyYWNraW5nICN7QHRvdWNoLnRyYWNrZWQubGVuZ3RofSB0b3VjaGVzXCJcclxuICAgICAgICBAdG91Y2gudHJhY2tlZFtpbmRleF0ucG9zID0gcG9pbnRlci5wb3NpdGlvbi5jbG9uZSgpXHJcblxyXG4gICAgICBpZiBAdG91Y2gudHJhY2tlZC5sZW5ndGggPT0gMVxyXG4gICAgICAgICMgc2luZ2xlIHRvdWNoLCBjb25zaWRlciBkcmFnZ2luZ1xyXG4gICAgICAgIGRyYWdEaXN0YW5jZSA9IEBjYWxjRGlzdGFuY2UgQHRvdWNoLmRyYWdYLCBAdG91Y2guZHJhZ1ksIEB0b3VjaC50cmFja2VkWzBdLnBvcy54LCBAdG91Y2gudHJhY2tlZFswXS5wb3MueVxyXG4gICAgICAgIGlmIEB0b3VjaC5kcmFnZ2luZyBvciAoZHJhZ0Rpc3RhbmNlID4gQHRvdWNoLkVOR0FHRV9EUkFHX0RJU1RBTkNFKVxyXG4gICAgICAgICAgQHRvdWNoLmRyYWdnaW5nID0gdHJ1ZVxyXG4gICAgICAgICAgaWYgZHJhZ0Rpc3RhbmNlID4gMC41XHJcbiAgICAgICAgICAgIGR4ID0gQHRvdWNoLnRyYWNrZWRbMF0ucG9zLnggLSBAdG91Y2guZHJhZ1hcclxuICAgICAgICAgICAgZHkgPSBAdG91Y2gudHJhY2tlZFswXS5wb3MueSAtIEB0b3VjaC5kcmFnWVxyXG4gICAgICAgICAgICAjIGNvbnNvbGUubG9nIFwic2luZ2xlIGRyYWc6ICN7ZHh9LCAje2R5fVwiXHJcbiAgICAgICAgICAgIEBjYW1lcmFzLm1haW4uc2Nyb2xsWCAtPSBkeCAvIEBjYW1lcmFzLm1haW4uem9vbVxyXG4gICAgICAgICAgICBAY2FtZXJhcy5tYWluLnNjcm9sbFkgLT0gZHkgLyBAY2FtZXJhcy5tYWluLnpvb21cclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nIFwic2Nyb2xsICN7QGNhbWVyYXMubWFpbi5zY3JvbGxYfSAje0BjYW1lcmFzLm1haW4uem9vbX0gI3tAY2FtZXJhcy5tYWluLndpZHRofVwiXHJcbiAgICAgICAgICBAc2V0RHJhZ1BvaW50KClcclxuXHJcbiAgICAgIGVsc2UgaWYgQHRvdWNoLnRyYWNrZWQubGVuZ3RoID49IDJcclxuICAgICAgICAjIGF0IGxlYXN0IHR3byBmaW5nZXJzIHByZXNlbnQsIGNoZWNrIGZvciBwaW5jaC96b29tXHJcbiAgICAgICAgY3VyckRpc3RhbmNlID0gQGNhbGNEaXN0YW5jZShAdG91Y2gudHJhY2tlZFswXS5wb3MueCwgQHRvdWNoLnRyYWNrZWRbMF0ucG9zLnksIEB0b3VjaC50cmFja2VkWzFdLnBvcy54LCBAdG91Y2gudHJhY2tlZFsxXS5wb3MueSlcclxuICAgICAgICBkZWx0YURpc3RhbmNlID0gY3VyckRpc3RhbmNlIC0gcHJldkRpc3RhbmNlXHJcbiAgICAgICAgaWYgZGVsdGFEaXN0YW5jZSAhPSAwXHJcbiAgICAgICAgICBuZXdab29tID0gQGNhbWVyYXMubWFpbi56b29tICogKDEgKyAoZGVsdGFEaXN0YW5jZSAqIDQgLyBAY2FtZXJhcy5tYWluLndpZHRoKSlcclxuICAgICAgICAgIGlmIG5ld1pvb20gPCAwLjFcclxuICAgICAgICAgICAgbmV3Wm9vbSA9IDAuMVxyXG4gICAgICAgICAgaWYgbmV3Wm9vbSA+IDVcclxuICAgICAgICAgICAgbmV3Wm9vbSA9IDVcclxuICAgICAgICAgIEBjYW1lcmFzLm1haW4uem9vbSA9IG5ld1pvb21cclxuXHJcbiAgICAgICAgICBoYWxmVyA9IChAY2FtZXJhcy5tYWluLndpZHRoIC8gMilcclxuICAgICAgICAgIGhhbGZIID0gKEBjYW1lcmFzLm1haW4uaGVpZ2h0IC8gMilcclxuICAgICAgICAgIG9mZnNldFggPSAoQHRvdWNoLnBpbmNoQW5jaG9yLnggLSBoYWxmVykgLyBuZXdab29tXHJcbiAgICAgICAgICBvZmZzZXRZID0gKEB0b3VjaC5waW5jaEFuY2hvci55IC0gaGFsZkgpIC8gbmV3Wm9vbVxyXG4gICAgICAgICAgQGNhbWVyYXMubWFpbi5zY3JvbGxYID0gQHRvdWNoLnBpbmNoQW5jaG9yV29ybGQueCAtIGhhbGZXIC0gb2Zmc2V0WFxyXG4gICAgICAgICAgQGNhbWVyYXMubWFpbi5zY3JvbGxZID0gQHRvdWNoLnBpbmNoQW5jaG9yV29ybGQueSAtIGhhbGZIIC0gb2Zmc2V0WVxyXG4gICAgICByZXR1cm5cclxuXHJcbiAgICBAaW5wdXQub24gJ3BvaW50ZXJ1cCcsIChwb2ludGVyKSA9PlxyXG4gICAgICBpZiBAdG91Y2gudHJhY2tlZC5sZW5ndGggPT0gMVxyXG4gICAgICAgIGlmIG5vdCBAdG91Y2guZHJhZ2dpbmdcclxuICAgICAgICAgIHdvcmxkUG9zID0gQGNhbWVyYXMubWFpbi5nZXRXb3JsZFBvaW50KEB0b3VjaC50cmFja2VkWzBdLnBvcy54LCBAdG91Y2gudHJhY2tlZFswXS5wb3MueSlcclxuICAgICAgICAgIGNvbnNvbGUubG9nIFwiVEFQICN7d29ybGRQb3MueH0gI3t3b3JsZFBvcy55fSAje0BjYW1lcmFzLm1haW4uc2Nyb2xsWH0gI3tAY2FtZXJhcy5tYWluLnNjcm9sbFl9ICN7QGNhbWVyYXMubWFpbi56b29tfVwiXHJcblxyXG4gICAgICBpbmRleCA9IC0xXHJcbiAgICAgIGZvciBpIGluIFswLi4uQHRvdWNoLnRyYWNrZWQubGVuZ3RoXVxyXG4gICAgICAgIGlmIEB0b3VjaC50cmFja2VkW2ldLmlkID09IHBvaW50ZXIuaWRcclxuICAgICAgICAgIGluZGV4ID0gaVxyXG4gICAgICAgICAgYnJlYWtcclxuICAgICAgaWYgaW5kZXggIT0gLTFcclxuICAgICAgICBAdG91Y2gudHJhY2tlZC5zcGxpY2UoaW5kZXgsIDEpXHJcbiAgICAgICAgaWYgQHRvdWNoLnRyYWNrZWQubGVuZ3RoID09IDFcclxuICAgICAgICAgIEBzZXREcmFnUG9pbnQoKVxyXG5cclxuICAgICAgICBpZiBpbmRleCA8IDJcclxuICAgICAgICAgICMgV2UganVzdCBmb3Jnb3Qgb25lIG9mIG91ciBwaW5jaCB0b3VjaGVzLiBQaWNrIGEgbmV3IGFuY2hvciBzcG90LlxyXG4gICAgICAgICAgQGNhbGNQaW5jaEFuY2hvcigpXHJcblxyXG4gICAgICBodWQgPSB0aGlzLnNjZW5lLmdldCgnaHVkJylcclxuICAgICAgaHVkLmdsYXNzLmFscGhhID0gMFxyXG4gICAgICByZXR1cm5cclxuXHJcbiAgY2FsY0Rpc3RhbmNlOiAoeDEsIHkxLCB4MiwgeTIpIC0+XHJcbiAgICBkeCA9IHgyIC0geDFcclxuICAgIGR5ID0geTIgLSB5MVxyXG4gICAgcmV0dXJuIE1hdGguc3FydChkeCpkeCArIGR5KmR5KVxyXG5cclxuICBzZXREcmFnUG9pbnQ6IC0+XHJcbiAgICBAdG91Y2guZHJhZ1ggPSBAdG91Y2gudHJhY2tlZFswXS5wb3MueFxyXG4gICAgQHRvdWNoLmRyYWdZID0gQHRvdWNoLnRyYWNrZWRbMF0ucG9zLnlcclxuXHJcbiAgY2FsY1BpbmNoQW5jaG9yOiAtPlxyXG4gICAgaWYgQHRvdWNoLnRyYWNrZWQubGVuZ3RoID49IDJcclxuICAgICAgcGluY2hYID0gTWF0aC5mbG9vcigoQHRvdWNoLnRyYWNrZWRbMF0ucG9zLnggKyBAdG91Y2gudHJhY2tlZFsxXS5wb3MueCkgLyAyKVxyXG4gICAgICBwaW5jaFkgPSBNYXRoLmZsb29yKChAdG91Y2gudHJhY2tlZFswXS5wb3MueSArIEB0b3VjaC50cmFja2VkWzFdLnBvcy55KSAvIDIpXHJcbiAgICAgIEB0b3VjaC5waW5jaEFuY2hvciA9IHt4OiBwaW5jaFgsIHk6IHBpbmNoWSB9XHJcbiAgICAgIEB0b3VjaC5waW5jaEFuY2hvcldvcmxkID0gQGNhbWVyYXMubWFpbi5nZXRXb3JsZFBvaW50KHBpbmNoWCwgcGluY2hZKSAjIHsgeDogcGluY2hYLCB5OiBwaW5jaFkgfVxyXG4gICAgICBjb25zb2xlLmxvZyBcInBpbmNoQW5jaG9yICN7QHRvdWNoLnBpbmNoQW5jaG9yLnh9ICN7QHRvdWNoLnBpbmNoQW5jaG9yLnl9XCJcclxuXHJcbiAgICAgIGh1ZCA9IHRoaXMuc2NlbmUuZ2V0KCdodWQnKVxyXG4gICAgICBodWQuZ2xhc3MueCA9IEB0b3VjaC5waW5jaEFuY2hvci54XHJcbiAgICAgIGh1ZC5nbGFzcy55ID0gQHRvdWNoLnBpbmNoQW5jaG9yLnlcclxuICAgICAgaHVkLmdsYXNzLmFscGhhID0gMVxyXG5cclxuICB0YXA6ICh3b3JsZFgsIHdvcmxkWSkgLT5cclxuICAgIGh1ZCA9IHRoaXMuc2NlbmUuZ2V0KCdodWQnKVxyXG4gICAgaHVkLmRlYnVnVGV4dC50ZXh0ID0gXCJUYXBwZWQ6ICN7d29ybGRYLnRvRml4ZWQoMSl9ICN7d29ybGRZLnRvRml4ZWQoMSl9XCJcclxuXHJcbiAgICBpZiAod29ybGRYID49IDApIGFuZCAod29ybGRYIDwgKEB3aWR0aCAqIDE2KSkgYW5kICh3b3JsZFkgPj0gMCkgYW5kICh3b3JsZFkgPCAoQGhlaWdodCAqIDE2KSlcclxuICAgICAgeCA9IE1hdGguZmxvb3Iod29ybGRYIC8gMTYpXHJcbiAgICAgIHkgPSBNYXRoLmZsb29yKHdvcmxkWSAvIDE2KVxyXG4gICAgICBAZ3JpZFt4XVt5XS5ib21iID0gIUBncmlkW3hdW3ldLmJvbWJcclxuICAgICAgaWYgQGdyaWRbeF1beV0uYm9tYlxyXG4gICAgICAgIEBncmlkW3hdW3ldLnNwcml0ZS5zZXRUZXh0dXJlKCdmbGFnJylcclxuICAgICAgZWxzZVxyXG4gICAgICAgIEBncmlkW3hdW3ldLnNwcml0ZS5zZXRUZXh0dXJlKCdibGFuaycpXHJcblxyXG5cclxuICB1cGRhdGU6IC0+XHJcblxyXG5jbGFzcyBCR01IdWRTY2VuZSBleHRlbmRzIFBoYXNlci5TY2VuZVxyXG4gIGNvbnN0cnVjdG9yOiAtPlxyXG4gICAgc3VwZXIoKVxyXG4gICAgUGhhc2VyLlNjZW5lLmNhbGwodGhpcywgeyBrZXk6ICdodWQnLCBhY3RpdmU6IHRydWUgfSk7XHJcblxyXG4gIHByZWxvYWQ6IC0+XHJcbiAgICBAbG9hZC5pbWFnZSgnZ2xhc3MnLCAnaW1hZ2VzL2dsYXNzLmdpZicpXHJcblxyXG4gIGNyZWF0ZTogLT5cclxuICAgIEBkZWJ1Z1RleHQgPSBAYWRkLnRleHQoMCwgMCwgJ1RhcCBzb21ld2hlcmUhJylcclxuICAgIEBnbGFzcyA9IEBhZGQuaW1hZ2UoNTAsIDUwLCAnZ2xhc3MnKVxyXG4gICAgQGdsYXNzLnNldE9yaWdpbigwLjYsIDAuMykgIyByb3VnaGx5IHRoZSBtaWRkbGUgb2YgdGhlIG1hZ25pZnlpbmcgZ2xhc3NcclxuICAgIEBnbGFzcy5hbHBoYSA9IDBcclxuXHJcbmluaXQgPSAtPlxyXG4gIGNvbnNvbGUubG9nIFwiQmFkIEd1eSBNaW5lc3dlZXBlcjogaW5pdCgpXCJcclxuXHJcbiAgY29uZmlnID1cclxuICAgIHR5cGU6IFBoYXNlci5BVVRPXHJcbiAgICB3aWR0aDogZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoXHJcbiAgICBoZWlnaHQ6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHRcclxuICAgIGJhY2tncm91bmRDb2xvcjogJyMyZDJkMmQnXHJcbiAgICBwYXJlbnQ6ICdzY3JlZW4nXHJcbiAgICBpbnB1dDpcclxuICAgICAgYWN0aXZlUG9pbnRlcnM6IDJcclxuICAgIHNjZW5lOiBbXHJcbiAgICAgIEJHTUdhbWVTY2VuZVxyXG4gICAgICBCR01IdWRTY2VuZVxyXG4gICAgXVxyXG5cclxuICBnYW1lID0gbmV3IFBoYXNlci5HYW1lKGNvbmZpZylcclxuXHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIChlKSAtPlxyXG4gICAgaW5pdCgpXHJcbiwgZmFsc2UpXHJcbiJdfQ==
